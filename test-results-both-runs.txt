$ bash run-tests.sh
=== Running WITHOUT React Compiler (baseline) ===
bun test v1.3.4 (5eb2145b)

 40 pass
 0 fail
 91 expect() calls
Ran 40 tests across 1 file. [1169.00ms]

=== Running WITH React Compiler ===
bun test v1.3.4 (5eb2145b)

rhf-compat.test.tsx:
101 | 
102 |     return (
103 |       <form>
104 |         <input data-testid="first-input" {...form.register('firstName')} />
105 |         <input data-testid="last-input" {...form.register('lastName')} />
106 |         <span data-testid="all-values">
                                                                  ^
error: expect(received).toBe(expected)

Expected: "hello"
Received: ""


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"name-input"[39m
          [33mname[39m=[32m"name"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"watched-value"[39m
        [36m/>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:106:61)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) form.watch('field') updates when input changes [1045.31ms]
285 |   // Should be submitting while the async handler is pending
286 |   await waitFor(() => {
287 |     expect(screen.getByTestId('submitting-status').textContent).toBe(
288 |       'submitting'
289 |     )
290 |   })
                                                               ^
error: expect(received).toBe(expected)

Expected: "John,"
Received: ","


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"first-input"[39m
          [33mname[39m=[32m"firstName"[39m
        [36m/>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"last-input"[39m
          [33mname[39m=[32m"lastName"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"all-values"[39m
        [36m>[39m
          [0m,[0m
        [36m</span>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:290:58)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) form.watch() (no args) triggers re-render on any field change [1018.36ms]
819 | 
820 | // Workaround: Use 'use no memo' for reset() as there's no safe alternative.
821 | // reset() is a mutating operation that needs the component to re-render to reflect changes.
822 | test('reset() clears form values and state (workaround)', async () => {
823 |   function ResetComponent() {
824 |     'use no memo'
                                                                  ^
error: expect(received).toBe(expected)

Expected: "context-test"
Received: ""


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"name-input"[39m
          [33mname[39m=[32m"name"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"context-value"[39m
        [36m/>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:824:61)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) useFormContext() propagates updates to children [1031.48ms]
941 |         <button data-testid="submit-btn" type="submit">Submit</button>
942 |         <span data-testid="submit-count">{submitCount}</span>
943 |       </form>
944 |     )
945 |   }
946 | 
                                                                     ^
error: expect(received).toBe(expected)

Expected: "blue"
Received: ""


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"controller-input"[39m
          [33mname[39m=[32m"color"[39m
          [33mvalue[39m=[32m"blue"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"controller-value"[39m
        [36m/>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:946:64)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) <Controller> updates on input change [1017.18ms]
1086 | // Test 19: watch() with callback function
1087 | // ---------------------------------------------------------------------------
1088 | // watch((data) => ...) subscribes to all changes with a callback.
1089 | // Compiler may not trigger the callback on form updates.
1090 | 
1091 | test('watch() with callback is invoked on form changes', async () => {
                                                                         ^
error: expect(received).toBe(expected)

Expected: "apple"
Received: ""


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"usecontroller-input"[39m
          [33mname[39m=[32m"fruit"[39m
          [33mvalue[39m=[32m"apple"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"usecontroller-value"[39m
        [36m/>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:1091:67)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) useController updates on input change [1018.30ms]
1556 | 
1557 | // ---------------------------------------------------------------------------
1558 | // Test 26: formState.isDirty via useFormContext updates after typing
1559 | // ---------------------------------------------------------------------------
1560 | // When formState is accessed via useFormContext() in a child component,
1561 | // the compiler may cache the child's render output because the context
                                                                      ^
error: expect(received).toBe(expected)

Expected: "test-msg"
Received: ""


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"message-input"[39m
          [33mname[39m=[32m"message"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"getvalues-result"[39m
        [36m/>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:1561:64)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) getValues() in render returns fresh values after typing [1021.51ms]
1881 | 
1882 |   await waitFor(() => {
1883 |     expect(screen.getByTestId('values-display').textContent).toBe('John,Doe')
1884 |   })
1885 | })
                                                                 ^
error: expect(received).toBe(expected)

Expected: "My Title"
Received: ""


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"title-input"[39m
          [33mname[39m=[32m"title"[39m
        [36m/>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"description-input"[39m
          [33mname[39m=[32m"description"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"title-value"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"description-value"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"reset-dirty"[39m
        [36m>[39m
          [0mdirty[0m
        [36m</span>[39m
        [36m<button[39m
          [33mdata-testid[39m=[32m"reset-btn"[39m
          [33mtype[39m=[32m"button"[39m
        [36m>[39m
          [0mReset[0m
        [36m</button>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:1885:59)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) reset() clears form values and state [1066.84ms]
2333 | 
2334 |   await waitFor(() => {
2335 |     expect(screen.getByTestId('values-display').textContent).toBe('John,Doe')
2336 |   })
2337 | })
                                                                ^
error: expect(received).toBe(expected)

Expected: "LA"
Received: "NYC"


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"city-input"[39m
          [33mname[39m=[32m"city"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"city-value"[39m
        [36m>[39m
          [0mNYC[0m
        [36m</span>[39m
        [36m<button[39m
          [33mdata-testid[39m=[32m"reset-btn"[39m
          [33mtype[39m=[32m"button"[39m
        [36m>[39m
          [0mReset to LA[0m
        [36m</button>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:2337:58)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) reset() with new defaultValues updates form values [1020.03ms]
2572 | 
2573 |   await waitFor(() => {
2574 |     expect(screen.getByTestId('values-display').textContent).toBe('John,Doe')
2575 |   })
2576 | })
                                                                                  ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"query-input"[39m
          [33mname[39m=[32m"query"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"effect-runs"[39m
        [36m>[39m
          [0m0[0m
        [36m</span>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:2576:76)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) watch in useEffect dependency array triggers effect [1020.81ms]
158 |   });
159 | }
160 | function waitForWrapper(callback, options) {
161 |   // create the error here so its stack trace is as close to the
162 |   // calling code as possible
163 |   const stackTraceError = new Error('STACK_TRACE_MESSAGE');
                                    ^
TestingLibraryElementError: Unable to find an element by: [data-testid="text-field"]

Ignored nodes: comments, script, style
[36m<body>[39m
  [36m<div>[39m
    [36m<form>[39m
      [36m<select[39m
        [33mdata-testid[39m=[32m"type-select"[39m
        [33mname[39m=[32m"type"[39m
      [36m>[39m
        [36m<option[39m
          [33mvalue[39m=[32m""[39m
        [36m>[39m
          [0mSelect...[0m
        [36m</option>[39m
        [36m<option[39m
          [33mvalue[39m=[32m"text"[39m
        [36m>[39m
          [0mText[0m
        [36m</option>[39m
        [36m<option[39m
          [33mvalue[39m=[32m"number"[39m
        [36m>[39m
          [0mNumber[0m
        [36m</option>[39m
      [36m</select>[39m
    [36m</form>[39m
  [36m</div>[39m
[36m</body>[39m

Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<select[39m
          [33mdata-testid[39m=[32m"type-select"[39m
          [33mname[39m=[32m"type"[39m
        [36m>[39m
          [36m<option[39m
            [33mvalue[39m=[32m""[39m
          [36m>[39m
            [0mSelect...[0m
          [36m</option>[39m
          [36m<option[39m
            [33mvalue[39m=[32m"text"[39m
          [36m>[39m
            [0mText[0m
          [36m</option>[39m
          [36m<option[39m
            [33mvalue[39m=[32m"number"[39m
          [36m>[39m
            [0mNumber[0m
          [36m</option>[39m
        [36m</select>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at waitForWrapper (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:163:31)
      at /Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:3368:7
      at processTicksAndRejections (native:1:1)
(fail) Conditional fields render based on watched value [1022.05ms]
3029 | 
3030 |   await waitFor(() => {
3031 |     expect(screen.getByTestId('values-display').textContent).toBe('John,Doe')
3032 |   })
3033 | })
                                                                  ^
error: expect(received).toBe(expected)

Expected: "Boston"
Received: ""


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"city-input"[39m
          [33mname[39m=[32m"user.address.city"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"nested-value"[39m
        [36m/>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:3033:60)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) Nested watch paths update on nested field changes [1025.02ms]
3301 | 
3302 |   await waitFor(() => {
3303 |     expect(screen.getByTestId('values-display').textContent).toBe('John,Doe')
3304 |   })
3305 | })
                                                                ^
error: expect(received).toBe(expected)

Expected: "2"
Received: "1"


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<div[39m
          [33mdata-testid[39m=[32m"item-count"[39m
        [36m>[39m
          [0m1[0m
        [36m</div>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"item-0"[39m
          [33mname[39m=[32m"items.0.name"[39m
        [36m/>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"item-1"[39m
          [33mname[39m=[32m"items.1.name"[39m
        [36m/>[39m
        [36m<button[39m
          [33mdata-testid[39m=[32m"add-btn"[39m
          [33mtype[39m=[32m"button"[39m
        [36m>[39m
          [0mAdd Item[0m
        [36m</button>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:3305:58)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) useFieldArray with watch reflects array changes [1012.62ms]
3631 | 
3632 |   await waitFor(() => {
3633 |     expect(screen.getByTestId('values-display').textContent).toBe('John,Doe')
3634 |   })
3635 | })
                                                                          ^
error: expect(received).toBe(expected)

Expected: "dirty"
Received: "clean"


Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form>[39m
        [36m<input[39m
          [33mdata-testid[39m=[32m"username-input"[39m
          [33mname[39m=[32m"username"[39m
        [36m/>[39m
        [36m<span[39m
          [33mdata-testid[39m=[32m"context-dirty-status"[39m
        [36m>[39m
          [0mclean[0m
        [36m</span>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/rhf-compat.test.tsx:3635:68)
      at runWithExpensiveErrorDiagnosticsDisabled (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@testing-library/dom/dist/wait-for.js:124:36)
      at <anonymous> (/Users/tim.kindberg/projects/react-compiler/rhf-compiler-compat/node_modules/@happy-dom/global-registrator/node_modules/happy-dom/lib/window/BrowserWindow.js:1262:30)
(fail) formState.isDirty via useFormContext updates after typing [1025.61ms]

 27 pass
 13 fail
 305 expect() calls
Ran 40 tests across 1 file. [15.41s]

=== COMPARISON ===
Baseline (no compiler):  0 passed, 0 failed
With compiler:           0 passed, 13 failed
